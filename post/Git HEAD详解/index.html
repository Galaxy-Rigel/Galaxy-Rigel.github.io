<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Git HEAD 详解 | 山水庄园</title><meta name="keywords" content="git"><meta name="author" content="Rigel"><meta name="copyright" content="Rigel"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="上一篇文章中，我们提到了一个概念，那就是HEAD，但是我们并没有详细的去解释HEAD是个什么东西？这篇文章我们就来聊聊什么是HEAD 为了方便，我仍然使用之前的测试仓库进行测试，你也可以随意的创建一个用于测试的git仓库，然后创建几条分支，以便测试时使用。 我们先来回顾一下前文中测试仓库的状态，如下： 注：下图中使用了前文中创建的allbranch视图  如上图所示，我们现在有两个分支，maste">
<meta property="og:type" content="article">
<meta property="og:title" content="Git HEAD 详解">
<meta property="og:url" content="http://www.lym5460.com/post/Git%20HEAD%E8%AF%A6%E8%A7%A3/index.html">
<meta property="og:site_name" content="山水庄园">
<meta property="og:description" content="上一篇文章中，我们提到了一个概念，那就是HEAD，但是我们并没有详细的去解释HEAD是个什么东西？这篇文章我们就来聊聊什么是HEAD 为了方便，我仍然使用之前的测试仓库进行测试，你也可以随意的创建一个用于测试的git仓库，然后创建几条分支，以便测试时使用。 我们先来回顾一下前文中测试仓库的状态，如下： 注：下图中使用了前文中创建的allbranch视图  如上图所示，我们现在有两个分支，maste">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="http://www.lym5460.com/img/cover2.jpg">
<meta property="article:published_time" content="2022-07-22T06:12:43.000Z">
<meta property="article:modified_time" content="2022-07-22T06:12:43.000Z">
<meta property="article:author" content="Rigel">
<meta property="article:tag" content="git">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://www.lym5460.com/img/cover2.jpg"><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="http://www.lym5460.com/post/Git%20HEAD%E8%AF%A6%E8%A7%A3/"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//fonts.googleapis.com" crossorigin=""/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Titillium+Web&amp;display=swap" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: {"path":"search.xml","languages":{"hits_empty":"找不到您查询的内容：${query}"}},
  translate: {"defaultEncoding":2,"translateDelay":0,"msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"簡"},
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":300},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '天',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: {"chs_to_cht":"你已切换为繁体","cht_to_chs":"你已切换为简体","day_to_night":"你已切换为深色模式","night_to_day":"你已切换为浅色模式","bgLight":"#49b1f5","bgDark":"#121212","position":"bottom-left"},
  source: {
    jQuery: 'https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js',
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/js/jquery.justifiedGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/css/justifiedGallery.min.css'
    },
    fancybox: {
      js: 'https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js',
      css: 'https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isanchor: true
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'Git HEAD 详解',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2022-07-22 14:12:43'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const fontSizeVal = saveToLocal.get('global-font-size')
    if (fontSizeVal !== undefined) {
      document.documentElement.style.setProperty('--global-font-size', fontSizeVal + 'px')
    }
    })(window)</script><meta name="generator" content="Hexo 5.4.0"></head><body><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="author-avatar"><img class="avatar-img" src="/img/avatar.jpeg" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data"><div class="data-item is-center"><div class="data-item-link"><a href="/archives/"><div class="headline">文章</div><div class="length-num">47</div></a></div></div><div class="data-item is-center"><div class="data-item-link"><a href="/tags/"><div class="headline">标签</div><div class="length-num">67</div></a></div></div><div class="data-item is-center"><div class="data-item-link"><a href="/categories/"><div class="headline">分类</div><div class="length-num">18</div></a></div></div></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><i class="fa-fw fas fa-list"></i><span> 随心</span><i class="fas fa-chevron-down expand"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/movies/"><i class="fa-fw fas fa-video"></i><span> 电影</span></a></li><li><a class="site-page child" href="/gallery/"><i class="fa-fw fas fa-images"></i><span> 相册</span></a></li><li><a class="site-page child" href="/artitalk/"><i class="fa-fw fas fa-comments"></i><span> 说说</span></a></li></ul></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('/img/cover2.jpg')"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">山水庄园</a></span><div id="menus"><div id="search-button"><a class="site-page social-icon search"><i class="fas fa-search fa-fw"></i><span> 搜索</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><i class="fa-fw fas fa-list"></i><span> 随心</span><i class="fas fa-chevron-down expand"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/movies/"><i class="fa-fw fas fa-video"></i><span> 电影</span></a></li><li><a class="site-page child" href="/gallery/"><i class="fa-fw fas fa-images"></i><span> 相册</span></a></li><li><a class="site-page child" href="/artitalk/"><i class="fa-fw fas fa-comments"></i><span> 说说</span></a></li></ul></div></div><div id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">Git HEAD 详解</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2022-07-22T06:12:43.000Z" title="发表于 2022-07-22 14:12:43">2022-07-22</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2022-07-22T06:12:43.000Z" title="更新于 2022-07-22 14:12:43">2022-07-22</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/git/">git</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="Git HEAD 详解"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"></span></span><span class="post-meta-separator">|</span><span class="post-meta-commentcount"><i class="far fa-comments fa-fw post-meta-icon"></i><span class="post-meta-label">评论数:</span><a href="/post/Git%20HEAD%E8%AF%A6%E8%A7%A3/#post-comment" itemprop="discussionUrl"><span class="valine-comment-count" data-xid="/post/Git%20HEAD%E8%AF%A6%E8%A7%A3/" itemprop="commentCount"></span></a></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><p>上一篇文章中，我们提到了一个概念，那就是HEAD，但是我们并没有详细的去解释HEAD是个什么东西？这篇文章我们就来聊聊什么是HEAD</p>
<p>为了方便，我仍然使用之前的测试仓库进行测试，你也可以随意的创建一个用于测试的git仓库，然后创建几条分支，以便测试时使用。</p>
<p>我们先来回顾一下前文中测试仓库的状态，如下：</p>
<p>注：下图中使用了前文中创建的allbranch视图</p>
<p><img src="https://www.zsythink.net/wp-content/uploads/2019/09/090119_1124_Git8HEAD1.png" alt="img"></p>
<p>如上图所示，我们现在有两个分支，master分支和test分支，从上图可以看出，目前我们处于黄色的提交，也就是test分支的”add D to m2″，如果我们想要切换回master分支，则可以使用前文中总结的如下命令</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">/d/workspace/git/test_repo1 (test)</span><br><span class="line"></span><br><span class="line">$ git checkout master</span><br><span class="line"></span><br><span class="line">Switched to branch &#x27;master&#x27;</span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">/d/workspace/git/test_repo1 (master)</span><br><span class="line"></span><br><span class="line">$</span><br></pre></td></tr></table></figure>

<p>如上述信息所示，我们已经从test分支切换到了master分支。</p>
<p>假设，我们现在关闭git bash和工作目录，当我们下次再次进入工作目录并且打开git bash时，仍然会显示为当前处于master分支，因为我们上次关闭工作目录之前，已经切换到了master分支，当然，如果你之前处于test分支，那么当你再次打开工作空间，仍然会显示你处于test分支。</p>
<p>那么问题来了，git是怎么知道我们当前该处于哪个分支呢？</p>
<p>git其实就是靠HEAD知道我们该处于哪个分支的，你可以把HEAD理解成一个指针，HEAD指针通常会指向一个分支（或者说指向一个分支指针），分支和分支指针的概念我们在前文中已经说明过，此处不再赘述，你可以把HEAD也理解成一个指针，这个指针通常指向一个分支指针，这样说不太直观，不如看下图（仍然在前文的图片的基础上进行修改）：</p>
<p><img src="https://www.zsythink.net/wp-content/uploads/2019/09/090119_1124_Git8HEAD2.png" alt="img"></p>
<p>如上图所示，由于我们当前处于master分支，所以，HEAD这个指针指向了master分支指针，如果我们现在检出test分支，那么HEAD指针就会指向test指针，也就是说，当我们从master分支检出到test分支时，HEAD指针会由上图中的状态变成下图中的状态：</p>
<p><img src="https://www.zsythink.net/wp-content/uploads/2019/09/090119_1124_Git8HEAD3.png" alt="img"></p>
<p>所以说，git只要找到HEAD，就能找到我们当前所处的分支（因为我们在切换分支时，会将HEAD指向所在的分支）。</p>
<p>我们可以直观的查看当前仓库的.git目录中的HEAD文件的内容，你会发现，其实.git/HEAD文件的内容就是HEAD指针所指向的分支，如下所示：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">/d/workspace/git/test_repo1 (master)</span><br><span class="line"></span><br><span class="line">$ cat .git/HEAD</span><br><span class="line"></span><br><span class="line">ref: refs/heads/master</span><br></pre></td></tr></table></figure>

<p>从上述返回信息可以看出，当前HEAD指针指向了另一个文件，这个文件就是.git/refs/heads/master，那么我们顺藤摸瓜，看看.git/refs/heads/master这个文件的文件内容</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">/d/workspace/git/test_repo1 (master)</span><br><span class="line"></span><br><span class="line">$ cat .git/refs/heads/master</span><br><span class="line"></span><br><span class="line">7406a10efcc169bbab17827aeda189aa20376f7f</span><br></pre></td></tr></table></figure>

<p>可以看到，这个文件的内容是一串哈希码，而这个哈希码正是master分支上最新的提交所对应的哈希码。</p>
<p>聪明如你，肯定已经看出来了，.git/HEAD文件和.git/refs/heads/master文件不正是上图中的HEAD指针和master分支指针么，没错，就是这样的，只不过，在Git中，这些代表了上图中”指针”的文件还有另外一个名字，它们被称之为”引用” （references 或者 refs），其实都是一样的东西，不用纠结于它们的名字。</p>
<p>为了证明我们的想法，我们切换几次分支， 看看.git/HEAD文件内容的变化</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">/d/workspace/git/test_repo1 (master)</span><br><span class="line"></span><br><span class="line">$ git checkout test</span><br><span class="line"></span><br><span class="line">Switched to branch &#x27;test&#x27;</span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">/d/workspace/git/test_repo1 (test)</span><br><span class="line"></span><br><span class="line">$ cat .git/HEAD</span><br><span class="line"></span><br><span class="line">ref: refs/heads/test</span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">/d/workspace/git/test_repo1 (test)</span><br><span class="line"></span><br><span class="line">$ git checkout master</span><br><span class="line"></span><br><span class="line">Switched to branch &#x27;master&#x27;</span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">/d/workspace/git/test_repo1 (master)</span><br><span class="line"></span><br><span class="line">$ cat .git/HEAD</span><br><span class="line"></span><br><span class="line">ref: refs/heads/master</span><br></pre></td></tr></table></figure>

<p>嗯嗯，看来是没错了，跟我们想的一样，HEAD指针通常指向我们所在的分支（的分支指针）。</p>
<p>前文中说过，当我们在某个分支上创建新的提交时，分支指针总是会指向当前分支的最新提交。</p>
<p>而刚才又说过，HEAD指针通常会指向当前所在分支的分支指针。</p>
<p>那么，结合上述两点，我们可以得出如下结论：</p>
<p>HEAD指针 ——–&gt; 分支指针 ——–&gt; 最新提交</p>
<p>也就是说，通常情况下，HEAD指针总是通过分支指针，间接的指向了当前分支的最新提交。</p>
<p>单纯的靠上述文字描述可能不够直观，不如通过实际的操作来验证一下，操作如下：</p>
<p>首先，我们切换回test分支，看看当前HEAD指针和分支指针的指向，如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">/d/workspace/git/test_repo1 (master)</span><br><span class="line"></span><br><span class="line">$ git checkout test</span><br><span class="line"></span><br><span class="line">Switched to branch &#x27;test&#x27;</span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">/d/workspace/git/test_repo1 (test)</span><br><span class="line"></span><br><span class="line">$ cat .git/HEAD</span><br><span class="line"></span><br><span class="line">ref: refs/heads/test</span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">/d/workspace/git/test_repo1 (test)</span><br><span class="line"></span><br><span class="line">$ cat .git/refs/heads/test</span><br><span class="line"></span><br><span class="line">30d80b030d1a960bd90f020be2a3efb657c978e9</span><br></pre></td></tr></table></figure>

<p>从上述命令可以看出，切换到test分支以后，HEAD指针指向了test分支指针，而test分支指针指向了30d80b0这个提交，如下图所示</p>
<p><img src="https://www.zsythink.net/wp-content/uploads/2019/09/090119_1124_Git8HEAD3.png" alt="img"></p>
<p>那么现在，我们来尝试在test分支上创建一个新的提交，看看HEAD指针和test分支指针会有哪些变化，操作如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">/d/workspace/git/test_repo1 (test)</span><br><span class="line"></span><br><span class="line">$ echo E &gt;&gt; m2</span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">/d/workspace/git/test_repo1 (test)</span><br><span class="line"></span><br><span class="line">$ git add m2</span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">/d/workspace/git/test_repo1 (test)</span><br><span class="line"></span><br><span class="line">$ git commit -m &quot;add E to m2&quot;</span><br><span class="line"></span><br><span class="line">[test 35cff8c] add E to m2</span><br><span class="line"></span><br><span class="line">1 file changed, 1 insertion(+)</span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">/d/workspace/git/test_repo1 (test)</span><br><span class="line"></span><br><span class="line">$ cat .git/HEAD</span><br><span class="line"></span><br><span class="line">ref: refs/heads/test</span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">/d/workspace/git/test_repo1 (test)</span><br><span class="line"></span><br><span class="line">$ cat .git/refs/heads/test</span><br><span class="line"></span><br><span class="line">35cff8cabb71d553ab1abceaf33fa5a046a17bdb</span><br></pre></td></tr></table></figure>

<p>如上所示，我们在test分支上创建了一个新的提交35cff8c，然后查看了.git/HEAD，发现HEAD指针仍然指向了test分支指针，而test分支指针已经指向了最新创建的提交，也就是35cff8c，如下图所示：</p>
<p><img src="https://www.zsythink.net/wp-content/uploads/2019/09/090119_1124_Git8HEAD4.png" alt="img"></p>
<p>所以说，通常情况下，HEAD指针总是指向了当前分支的最新提交（通过分支指针间接的指向）。</p>
<h2 id="什么是分离头"><a href="#什么是分离头" class="headerlink" title="什么是分离头"></a>什么是分离头</h2><p>刚才一直在说，”通常情况下”，HEAD总是指向当前所在的分支（即指向当前分支的分支指针）。</p>
<p>既然有”通常情况下”，肯定还有”不是那么通常的情况”，这种所谓的”不是那么通常的情况”，就是我们现在要描述的情况，这种情况被称之为”分离头”（detached HEAD），那么” 分离头”是什么意思呢？其实很简单，分离头的状态其实就是HEAD指针没有指向分支指针，而是直接指向了某个提交，比如下图中的情况</p>
<p><img src="https://www.zsythink.net/wp-content/uploads/2019/09/090119_1124_Git8HEAD5.png" alt="img"></p>
<p>如上图所示HEAD指针没有指向任何一个分支，而是直接指向了上图中的C3这个提交，这种情况就是”分离头”（detached HEAD）的情况，从字面上理解，” 分离头”或者称之为” 头分离”的这种情况就是HEAD指针（头指针）和分支指针分开了，HEAD指针和分支指针分开后，指向了某个提交。</p>
<p>上图的HEAD指针直接指向了C3这个提交，上图只是为了示例，所以随意的指向了一个提交，HEAD指针直接指向任何一个提交的情况都属于分离头，所以，不要纠结于上图的HEAD指针指向了哪个提交。</p>
<p>那么我们进行什么操作时才会进入到分离头的状态呢？很简单，当我们直接检出一个提交（而不是检出某个分支），就可以进出分离头状态，在之前的操作中，我们使用git checkout命令都是检出某个分支，那么现在，我们直接在git checkout命令后面指定某个提交的哈希码，即可进入到分离头的状态。下面我们来动手操作一下，不过在开始之前，我们先来看看各个分支以及HEAD指针的状态，使用”git log –oneline –all –graph”命令可以在命令行中以字符的形式尽量接近图形化的方式展示分支，如下：</p>
<p><img src="https://www.zsythink.net/wp-content/uploads/2019/09/090119_1124_Git8HEAD6.png" alt="img"></p>
<p>当然，使用上述方式和使用gitk图形化的方式都能查看分支，但是我个人还是习惯使用gitk图形化工具查看分支，毕竟图形化工具相对美观一些，在后文中还是会尽可能的使用图形化的，不过从上图可以更加直观的看出，当前我们处于test分支，HEAD指针指向了test分支。此时，运行gitk命令，看到的分支图如下（下图中使用了前文中创建的allbranch视图）：</p>
<p><img src="https://www.zsythink.net/wp-content/uploads/2019/09/090119_1124_Git8HEAD7.png" alt="img"></p>
<p>在上图中，你可以直观的看到test分支指针和master分支指针，但是你看不到HEAD指针，其实，上图中的黄色提交就是HEAD指针所在的位置（或者你也可以把HEAD指针理解成一个黄色的圆球），也就是说，从上图可以看出，HEAD指针现在指向了test分支。</p>
<p>现在，我们想要做的是造成所谓的” 分离头”状态，也就是说，我们想让HEAD指针指向某个提交，而不是指向某个分支指针。</p>
<p>我们随便检出到某个提交，都可以进入分离头状态，操作如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">/d/workspace/git/test_repo1 (test)</span><br><span class="line"></span><br><span class="line">$ git checkout cbd3348</span><br><span class="line"></span><br><span class="line">Note: checking out &#x27;cbd3348&#x27;.</span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">You are in &#x27;detached HEAD&#x27; state. You can look around, make experimental</span><br><span class="line"></span><br><span class="line">changes and commit them, and you can discard any commits you make in this</span><br><span class="line"></span><br><span class="line">state without impacting any branches by performing another checkout.</span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">If you want to create a new branch to retain commits you create, you may</span><br><span class="line"></span><br><span class="line">do so (now or later) by using -b with the checkout command again. Example:</span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">git checkout -b &lt;new-branch-name&gt;</span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">HEAD is now at cbd3348 add 2 in m1</span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">/d/workspace/git/test_repo1 ((cbd3348...))</span><br><span class="line"></span><br><span class="line">$</span><br></pre></td></tr></table></figure>

<p>从上述信息可以看出，我检出了哈希码为cbd3348的提交，也就是”add 2 in m1″对应的提交，当我执行上述命令后，git的返回信息也在提示我们，You are in ‘detached HEAD’ state.（你现在处于’分离头’状态），我们检出了’cbd3348’这个提交，现在，当前目录就处于‘cbd3348’这个提交对应的状态，也就是说，目录中所有文件的内容都与’cbd3348’这个状态对应，执行上述命令后，命令提示符中也显示了当前提交的哈希码。</p>
<p>那么现在，我们再次执行 “git log –oneline –all –graph”命令，看看现在HEAD指针所处的位置，如下：</p>
<p><img src="https://www.zsythink.net/wp-content/uploads/2019/09/090119_1124_Git8HEAD8.png" alt="img"></p>
<p>从上图可以看出，HEAD指针目前没有指向任何一个分支指针，而是直接指向了’cbd3348’这个提交，这就是所谓的分离头状态。</p>
<p>如果此时你使用gitk图形化界面，会发现’cbd3348’这个提交变成了黄色，如下：</p>
<p><img src="https://www.zsythink.net/wp-content/uploads/2019/09/090119_1124_Git8HEAD9.png" alt="img"></p>
<p>也就是说，HEAD指针目前处于’cbd3348’这个提交，并没有指向任何分支。</p>
<p>如果此时在命令行中执行’git status’命令，同样会提示你，你当前处于分离头状态，如下</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">/d/workspace/git/test_repo1 ((cbd3348...))</span><br><span class="line"></span><br><span class="line">$ git status</span><br><span class="line"></span><br><span class="line">HEAD detached at cbd3348</span><br><span class="line"></span><br><span class="line">nothing to commit, working tree clean</span><br></pre></td></tr></table></figure>

<h2 id="分离头状态的使用场景"><a href="#分离头状态的使用场景" class="headerlink" title="分离头状态的使用场景"></a>分离头状态的使用场景</h2><p>那么分离头状态有什么用呢？该怎么用呢？</p>
<p>其实，从上文的返回信息中就能找到答案。在我们执行’ git checkout cbd3348’这条命令时，git就返回了很长一段信息，返回信息如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">Note: checking out &#x27;cbd3348&#x27;.</span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">You are in &#x27;detached HEAD&#x27; state. You can look around, make experimental</span><br><span class="line"></span><br><span class="line">changes and commit them, and you can discard any commits you make in this</span><br><span class="line"></span><br><span class="line">state without impacting any branches by performing another checkout.</span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">If you want to create a new branch to retain commits you create, you may</span><br><span class="line"></span><br><span class="line">do so (now or later) by using -b with the checkout command again. Example:</span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">git checkout -b &lt;new-branch-name&gt;</span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">HEAD is now at cbd3348 add 2 in m1</span><br></pre></td></tr></table></figure>

<p>注：我先大概的描述一下上述返回信息，后面会有实际的示例，所以，不明白上述返回信息的意思也不用纠结，看到最后自然就会明白。</p>
<p>从上述返回信息我们可以得知，我们当前检出了’cbd3348’这个提交，现在我们处于分离头的状态，git建议我们，在分离头的状态下，我们可以随便看看，可以按照我们的想法，对当前目录中的文件进行一些实验性的修改，并且将这些实验性的修改创建成一些提交（其实这些提交会组成一条匿名分支），如果你最后后悔了，觉得实验不成功，修改后的结果并不是你想要的，那么我们可以在不影响任何其他分支和提交的情况下，丢弃这些实验性的提交（丢弃这条匿名分支），如果你觉得这些实验性的提交让你很满意，那么你就可以创建一个新的分支（其实是给这个匿名分支一个固定的名字），来永久性的保存这些提交。</p>
<p>只是通过语言描述的方式，可能并不是特别容易理解分离头状态的用处，不如，我们就在分离头的状态下随便做些修改，然后创建一些提交，通过实际操作来认识分离头状态的使用方法吧，操作如下：</p>
<p>首先，看看当前目录中各个文件的状态</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">/d/workspace/git/test_repo1 ((cbd3348...))</span><br><span class="line"></span><br><span class="line">$ git status</span><br><span class="line"></span><br><span class="line">HEAD detached at cbd3348</span><br><span class="line"></span><br><span class="line">nothing to commit, working tree clean</span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">/d/workspace/git/test_repo1 ((cbd3348...))</span><br><span class="line"></span><br><span class="line">$ cat m1</span><br><span class="line"></span><br><span class="line">1</span><br><span class="line"></span><br><span class="line">2</span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">/d/workspace/git/test_repo1 ((cbd3348...))</span><br><span class="line"></span><br><span class="line">$ cat m2</span><br><span class="line"></span><br><span class="line">A</span><br></pre></td></tr></table></figure>

<p>由于刚才我们直接检出了’cbd3348’这个提交，所以，我们处于分离头状态，而且当前仓库中各个文件的内容也回到了’cbd3348’这个提交对应的状态，假设，此时我想对m1这个文件进行一些修改，于是，我进行了如下一系列的操作</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line">/d/workspace/git/test_repo1 ((cbd3348...))</span><br><span class="line"></span><br><span class="line">$ echo 3test &gt;&gt; m1</span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">/d/workspace/git/test_repo1 ((cbd3348...))</span><br><span class="line"></span><br><span class="line">$ git add m1</span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">/d/workspace/git/test_repo1 ((cbd3348...))</span><br><span class="line"></span><br><span class="line">$ git commit -m &quot;add 3test in m1&quot;</span><br><span class="line"></span><br><span class="line">[detached HEAD c22af40] add 3test in m1</span><br><span class="line"></span><br><span class="line">1 file changed, 1 insertion(+)</span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">/d/workspace/git/test_repo1 ((c22af40...))</span><br><span class="line"></span><br><span class="line">$ echo 4test &gt;&gt; m1</span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">/d/workspace/git/test_repo1 ((c22af40...))</span><br><span class="line"></span><br><span class="line">$ git add m1</span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">/d/workspace/git/test_repo1 ((c22af40...))</span><br><span class="line"></span><br><span class="line">$ git commit -m &quot;add 4test in m1&quot;</span><br><span class="line"></span><br><span class="line">[detached HEAD dca15df] add 4test in m1</span><br><span class="line"></span><br><span class="line">1 file changed, 1 insertion(+)</span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">/d/workspace/git/test_repo1 ((dca15df...))</span><br><span class="line"></span><br><span class="line">$</span><br></pre></td></tr></table></figure>

<p>从上述命令可以看出，我先在m1文件中加了一行”3test”，并且为这次修改创建了一个新的提交，新提交的哈希码是c22af40，当新提交c22af40被创建以后，命令提示符中的哈希码就变成了c22af40，然后，我又在m1文件中加了一行”4test”，并且为这次修改也创建了一个新提交，新提交的哈希码为dca15df，同样，这个提交被创建以后，命令提示符中的哈希码就变成了最新提交的哈希码，好了，现在我们已经在分离头的状态下创建了两个新提交，那么此时，我们来看看各个分支的状态以及HEAD指针的位置，打开gitk图形化界面，如下：</p>
<p>注：此处使用”gitk –all”命令打开gitk图形化界面，”–all”参数表示显示所有分支，你也可以打开gitk以后，选择前文中保存过的视图来查看所有分支。</p>
<p><img src="https://www.zsythink.net/wp-content/uploads/2019/09/090119_1124_Git8HEAD10.png" alt="img"></p>
<p>从上图可以看出，HEAD指针已经指向了最新的提交，这个提交就是我们刚才创建的”add 4test in m1″，而且从上图可以看出，从”add 2 in m1″分出了一条分支，”add 2 in m1″是一个分叉点，这个分叉点就是上文中的‘cbd3348’提交，我们直接检出了’cbd3348’这个提交，进入到了分离头的状态，然后在分离头的状态下，创建了两个新提交，这两个新提交就是”add 3test in m1″和”add 4test in m1″，这两个新提交与分叉点之前的提交组成了一条匿名分支，没有任何一个分支标签指向这个匿名分支。</p>
<p>我们现在有两个选择，如下：</p>
<p>选择一：丢弃这个匿名分支</p>
<p>选择二：保留这个匿名分支</p>
<p>上述两种选择分别对应了不同的操作，我们后续再进行实际的示例。</p>
<p>看到这里，我似乎明白了分离头的使用场景，说白了，分离头的状态不就是让我们可以随意的检出某个提交，然后基于这个提交创建一些新提交么，这些新创建的提交是偏实验性质的，为什么这么说呢？因为我们可能会保存这些提交，也有可能放弃这些提交，你可以根据最终的结果判断是否保存这些提交，这些新创建的提交可以理解成一条匿名分支。</p>
<p>好了，刚才说过，我们可以选择放弃这个匿名分支，也可以选择保留它，那么具体该怎么操作呢？一个一个聊</p>
<p>先说说怎样放弃这些提交，如果你对这些实验性的提交不满意，你可以直接检出到任何一个别的分支，就相当于放弃了这些提交，就是这么简单。比如，我们当前处于分离头状态，现在我们直接检出到test分支，示例操作如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">/d/workspace/git/test_repo1 ((dca15df...))</span><br><span class="line"></span><br><span class="line">$ git checkout test</span><br><span class="line"></span><br><span class="line">Warning: you are leaving 2 commits behind, not connected to</span><br><span class="line"></span><br><span class="line">any of your branches:</span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">dca15df add 4test in m1</span><br><span class="line"></span><br><span class="line">c22af40 add 3test in m1</span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">If you want to keep them by creating a new branch, this may be a good time</span><br><span class="line"></span><br><span class="line">to do so with:</span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">git branch &lt;new-branch-name&gt; dca15df</span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">Switched to branch &#x27;test&#x27;</span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">/d/workspace/git/test_repo1 (test)</span><br></pre></td></tr></table></figure>

<p>如上例所示，当我们直接从分离头状态检出到其他分支时，git会提示我们，你落下了2个提交在后面，这两个提交没有关联到任何分支，这两个提交是……（你创建的提交信息），如果你想要保存它们，那么你可以……(git在这时其实就已经给出了保留这个匿名分支的命令，不过这个命令我们放到后面再聊)，如上例所示，我们从分离头状态已经检出到了别的分支（test分支），这就相当于放弃了那些实验性的提交（匿名分支），此时运行” gitk –all”命令，查看HEAD以及分支的状况，如下图所示</p>
<p><img src="https://www.zsythink.net/wp-content/uploads/2019/09/090119_1124_Git8HEAD7.png" alt="img"></p>
<p>你会发现，那条匿名分支已经不见了，因为没有任何一个指针指向那些提交，所以，那些实验性的提交会在过一段时间后被git的垃圾回收机制清除，因为我们不想要它们了，所以不用理会它们，它们就好像不存在一样，也不会对其他分支和提交造成影响。上述操作就是丢弃这些实验性提交的方法，是不是很简单？</p>
<p>如果我们想要永久的保存那些在分离头状态下创建的提交该怎么办呢？</p>
<p>其实也很简单，我们只需要将这些提交创建成一条新的分支就行了（或者也可以理解成为匿名分支命名），为了方便演示，我再次检出到dca15df这个提交（这个提交是之前在演示分离头状态时创建的最新的提交），检出dca15df提交是为了回到之前的分离头状态，以便演示怎样在分离头的状态下保存那些实验性的提交，检出dca15df提交的命令如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">/d/workspace/git/test_repo1 (test)</span><br><span class="line"></span><br><span class="line">$ git checkout dca15df</span><br><span class="line"></span><br><span class="line">Note: checking out &#x27;dca15df&#x27;.</span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">You are in &#x27;detached HEAD&#x27; state. You can look around, make experimental</span><br><span class="line"></span><br><span class="line">changes and commit them, and you can discard any commits you make in this</span><br><span class="line"></span><br><span class="line">state without impacting any branches by performing another checkout.</span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">If you want to create a new branch to retain commits you create, you may</span><br><span class="line"></span><br><span class="line">do so (now or later) by using -b with the checkout command again. Example:</span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">git checkout -b &lt;new-branch-name&gt;</span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">HEAD is now at dca15df add 4test in m1</span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">/d/workspace/git/test_repo1 ((dca15df...))</span><br></pre></td></tr></table></figure>

<p>从上述命令可以看出，当我们从test分支检出到’dca15df’提交以后，git又从”通常状态”进入到了”分离头状态”，并且git再次提示我们，你可以通过” git checkout -b <new-branch-name>”命令创建一个新的分支以便来保存这些在分离头状态下创建的提交，假设，我们想要创建一个名为newtest的分支来保存这些提交，那么可以直接执行如下命令：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git checkout -b newtest</span><br></pre></td></tr></table></figure>

<p>执行上述命令后，新创建的newtest分支指针就会指向我们当前所在的提交（即dca15df提交），这样，我们就能永久的保存这些提交了。<br>当然，除了” git checkout -b newtest”命令，你也可以使用如下类似的命令来创建一个分支来保存分离头状态下创建的提交，比如如下命令</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git branch newtest dca15df</span><br></pre></td></tr></table></figure>

<p>上述命令的意思是在dca15df提交的位置创建一个名为newtest的分支（此命令不会自动检出到新创建的分支，会停留在原位置，但是新的分支指针会在指定的提交处创建），细心如你肯定已经发现了，在之前的示例过程中，当我们从dca15df提交的分离头状态检出到test分支时，git同样会提示你使用”git branch <new-branch-name> dca15df”命令来保存分离头状态下创建的那些提交，其实，命令虽然不同，但是本质上的目标都是创建一个分支来保存分离头状态下的提交（换一种说法就是给分离头状态下产生的匿名分支命名）。</p>
<p>说了这么多，你肯定明白了分离头指针的使用场景，当你想要基于某个提交进行一些实验或者测试，可以直接检出这个提交，立马在上面开始实验/测试工作，如果结果满意，就保留，如果结果不满意，就丢弃。你可能会说，我直接基于指定的提交创建一个新的分支，然后在新的分支上进行实验不是也可以吗？是的，完全可以，没有任何问题，只是，如果实验结果不满意，你可能还想要删除这条用于实验的分支，而使用分离头，就可以先实验，再判断是否保留这些提交，避免了在不满意的情况下创建分支或者删除分支的操作。</p>
<blockquote>
<p>本文转载自：<a target="_blank" rel="noopener" href="https://www.zsythink.net/archives/3412/">https://www.zsythink.net/archives/3412/</a></p>
</blockquote>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="mailto:undefined">Rigel</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="http://www.lym5460.com/post/Git%20HEAD%E8%AF%A6%E8%A7%A3/">http://www.lym5460.com/post/Git HEAD详解/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="http://www.lym5460.com" target="_blank">山水庄园</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/git/">git</a></div><div class="post_share"><div class="social-share" data-image="/img/cover2.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/social-share.js/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/post/Unicode%E4%B8%8EUTF-8/"><img class="prev-cover" src="/img/cover1.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">Unicode与UTF-8</div></div></a></div><div class="next-post pull-right"><a href="/post/Git%20%E4%B8%80%E7%AF%87%E5%B0%B1%E5%A4%9F%E4%BA%86/"><img class="next-cover" src="/img/cover6.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">Git 一篇就够了</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span> 相关推荐</span></div><div class="relatedPosts-list"><div><a href="/post/Git 一篇就够了/" title="Git 一篇就够了"><img class="cover" src="/img/cover6.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-07-12</div><div class="title">Git 一篇就够了</div></div></a></div></div></div><hr/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> 评论</span></div></div><div class="comment-wrap"><div><div class="vcomment" id="vcomment"></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="card-info-avatar is-center"><img class="avatar-img" src="/img/avatar.jpeg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/><div class="author-info__name">Rigel</div><div class="author-info__description">千里之行始于足下</div></div><div class="card-info-data"><div class="card-info-data-item is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">47</div></a></div><div class="card-info-data-item is-center"><a href="/tags/"><div class="headline">标签</div><div class="length-num">67</div></a></div><div class="card-info-data-item is-center"><a href="/categories/"><div class="headline">分类</div><div class="length-num">18</div></a></div></div><a class="button--animated" id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/Galaxy-Rigel"><i class="fab fa-github"></i><span>Follow Me</span></a><div class="card-info-social-icons is-center"><a class="social-icon" href="https://github.com/Galaxy-Rigel" target="_blank" title="Github"><i class="fab fa-github"></i></a><a class="social-icon" href="mailto:822616692@qq.com" target="_blank" title="Email"><i class="fas fa-envelope"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn card-announcement-animation"></i><span>公告</span></div><div class="announcement_content">感谢访问本站，若喜欢请收藏^_^</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BB%80%E4%B9%88%E6%98%AF%E5%88%86%E7%A6%BB%E5%A4%B4"><span class="toc-number">1.</span> <span class="toc-text">什么是分离头</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%88%86%E7%A6%BB%E5%A4%B4%E7%8A%B6%E6%80%81%E7%9A%84%E4%BD%BF%E7%94%A8%E5%9C%BA%E6%99%AF"><span class="toc-number">2.</span> <span class="toc-text">分离头状态的使用场景</span></a></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/post/ahooks/" title="浅谈 ahooks"><img src="/img/cover2.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="浅谈 ahooks"/></a><div class="content"><a class="title" href="/post/ahooks/" title="浅谈 ahooks">浅谈 ahooks</a><time datetime="2023-02-09T02:30:49.000Z" title="发表于 2023-02-09 10:30:49">2023-02-09</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/post/npn%20version/" title="npm version"><img src="/img/cover3.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="npm version"/></a><div class="content"><a class="title" href="/post/npn%20version/" title="npm version">npm version</a><time datetime="2023-01-31T10:12:43.000Z" title="发表于 2023-01-31 18:12:43">2023-01-31</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/post/husky+lint-staged+commitlint/" title="ESLint, Prettier, Commitizen, Husky 规范代码"><img src="/img/cover5.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="ESLint, Prettier, Commitizen, Husky 规范代码"/></a><div class="content"><a class="title" href="/post/husky+lint-staged+commitlint/" title="ESLint, Prettier, Commitizen, Husky 规范代码">ESLint, Prettier, Commitizen, Husky 规范代码</a><time datetime="2023-01-29T12:40:49.000Z" title="发表于 2023-01-29 20:40:49">2023-01-29</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/post/%E4%BA%8C%E8%BF%9B%E5%88%B6-%E4%BD%8D%E8%BF%90%E7%AE%97%E5%8F%8A%E5%85%B6%E5%BA%94%E7%94%A8/" title="谈谈二进制——位运算及其应用"><img src="/img/cover2.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="谈谈二进制——位运算及其应用"/></a><div class="content"><a class="title" href="/post/%E4%BA%8C%E8%BF%9B%E5%88%B6-%E4%BD%8D%E8%BF%90%E7%AE%97%E5%8F%8A%E5%85%B6%E5%BA%94%E7%94%A8/" title="谈谈二进制——位运算及其应用">谈谈二进制——位运算及其应用</a><time datetime="2022-08-09T10:30:49.000Z" title="发表于 2022-08-09 18:30:49">2022-08-09</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/post/%E4%BA%8C%E8%BF%9B%E5%88%B6-%E5%8E%9F%E7%A0%81%E3%80%81%E8%A1%A5%E7%A0%81%E3%80%81%E5%8F%8D%E7%A0%81%E3%80%81%E7%A7%BB%E7%A0%81/" title="谈谈二进制-原码、补码、反码、移码"><img src="/img/cover2.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="谈谈二进制-原码、补码、反码、移码"/></a><div class="content"><a class="title" href="/post/%E4%BA%8C%E8%BF%9B%E5%88%B6-%E5%8E%9F%E7%A0%81%E3%80%81%E8%A1%A5%E7%A0%81%E3%80%81%E5%8F%8D%E7%A0%81%E3%80%81%E7%A7%BB%E7%A0%81/" title="谈谈二进制-原码、补码、反码、移码">谈谈二进制-原码、补码、反码、移码</a><time datetime="2022-08-09T10:30:49.000Z" title="发表于 2022-08-09 18:30:49">2022-08-09</time></div></div></div></div></div></div></main><footer id="footer" style="background-image: url('/img/cover2.jpg')"><div id="footer-wrap"><div class="copyright">&copy;2020 - 2023 By Rigel</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div><div class="footer_custom_text">欢迎来到山水庄园，请喝茶 o(*￣︶￣*)o</div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="font-plus" type="button" title="放大字体"><i class="fas fa-plus"></i></button><button id="font-minus" type="button" title="缩小字体"><i class="fas fa-minus"></i></button><button id="translateLink" type="button" title="简繁转换">繁</button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><a id="to_comment" href="#post-comment" title="直达评论"><i class="fas fa-comments"></i></a><button id="go-up" type="button" title="回到顶部"><i class="fas fa-arrow-up"></i></button></div></div><div id="local-search"><div class="search-dialog"><div class="search-dialog__title" id="local-search-title">本地搜索</div><div id="local-input-panel"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"/></div></div></div><hr/><div id="local-search-results"></div><span class="search-close-button"><i class="fas fa-times"></i></span></div><div id="search-mask"></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://cdn.jsdelivr.net/npm/instant.page/instantpage.min.js" type="module"></script><script src="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.js"></script><script src="/js/search/local-search.js"></script><div class="js-pjax"><script>if (document.getElementsByClassName('mermaid').length) {
  if (window.mermaidJsLoad) mermaid.init()
  else {
    getScript('https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js').then(() => {
      window.mermaidJsLoad = true
      mermaid.initialize({
        theme: 'default',
      })
      true && mermaid.init()
    })
  }
}</script><script>function loadValine () {
  function initValine () {
    const valine = new Valine(Object.assign({
      el: '#vcomment',
      appId: 'QAFuYWYPEMElYLYTf5P1tG8A-gzGzoHsz',
      appKey: 'UBoQAeyYQhTWvEkggwYM7fsz',
      placeholder: '记得留下你的昵称和邮箱，可以快速收到回復',
      avatar: 'monsterid',
      meta: 'nick,mail,link'.split(','),
      pageSize: '10',
      lang: 'zh-CN',
      recordIP: false,
      serverURLs: 'https://qafuywyp.lc-cn-n1-shared.com',
      emojiCDN: '',
      emojiMaps: "",
      enableQQ: false,
      path: window.location.pathname,
      requiredFields: ["nick,mail"],
      visitor: false
    }, null))
  }

  if (typeof Valine === 'function') initValine() 
  else getScript('https://cdn.jsdelivr.net/npm/valine/dist/Valine.min.js').then(initValine)
}

if ('Valine' === 'Valine' || !false) {
  if (false) btf.loadComment(document.getElementById('vcomment'),loadValine)
  else setTimeout(loadValine, 0)
} else {
  function loadOtherComment () {
    loadValine()
  }
}</script></div><script src="https://cdn.jsdelivr.net/npm/blueimp-md5@2.17.0/js/md5.min.js"></script><script>window.addEventListener('load', () => {
  const changeContent = (content) => {
    if (content === '') return content

    content = content.replace(/<img.*?src="(.*?)"?[^\>]+>/ig, '[图片]') // replace image link
    content = content.replace(/<a[^>]+?href=["']?([^"']+)["']?[^>]*>([^<]+)<\/a>/gi, '[链接]') // replace url
    content = content.replace(/<pre><code>.*?<\/pre>/gi, '[代码]') // replace code
    content = content.replace(/<[^>]+>/g,"") // remove html tag

    if (content.length > 150) {
      content = content.substring(0,150) + '...'
    }
    return content
  }

  const getIcon = (icon, mail) => {
    if (icon) return icon
    let defaultIcon = '?d=monsterid'
    let iconUrl = `https://gravatar.loli.net/avatar/${md5(mail.toLowerCase()) + defaultIcon}`
    return iconUrl
  }

  const generateHtml = array => {
    let result = ''

    if (array.length) {
      for (let i = 0; i < array.length; i++) {
        result += '<div class=\'aside-list-item\'>'

        if (true) {
          const name = 'src'
          result += `<a href='${array[i].url}' class='thumbnail'><img ${name}='${array[i].avatar}' alt='${array[i].nick}'></a>`
        }

        result += `<div class='content'>
        <a class='comment' href='${array[i].url}'>${array[i].content}</a>
        <div class='name'><span>${array[i].nick} / </span><time datetime="${array[i].date}">${btf.diffDate(array[i].date, true)}</time></div>
        </div></div>`
      }
    } else {
      result += '没有评论'
    }

    let $dom = document.querySelector('#card-newest-comments .aside-list')
    $dom.innerHTML= result
    window.lazyLoadInstance && window.lazyLoadInstance.update()
    window.pjax && window.pjax.refresh($dom)
  }

  const getComment = () => {
    const serverURL = 'https://qafuywyp.lc-cn-n1-shared.com'

    var settings = {
      "method": "GET",
      "headers": {
        "X-LC-Id": 'QAFuYWYPEMElYLYTf5P1tG8A-gzGzoHsz',
        "X-LC-Key": 'UBoQAeyYQhTWvEkggwYM7fsz',
        "Content-Type": "application/json"
      },
    }

    fetch(`${serverURL}/1.1/classes/Comment?limit=6&order=-createdAt`,settings)
      .then(response => response.json())
      .then(data => {
        const valineArray = data.results.map(function (e) {
          return {
            'avatar': getIcon(e.QQAvatar, e.mail),
            'content': changeContent(e.comment),
            'nick': e.nick,
            'url': e.url + '#' + e.objectId,
            'date': e.updatedAt,
          }
        })
        saveToLocal.set('valine-newest-comments', JSON.stringify(valineArray), 10/(60*24))
        generateHtml(valineArray)
      }).catch(e => {
        const $dom = document.querySelector('#card-newest-comments .aside-list')
        $dom.innerHTML= "无法获取评论，请确认相关配置是否正确"
      }) 
  }

  const newestCommentInit = () => {
    if (document.querySelector('#card-newest-comments .aside-list')) {
      const data = saveToLocal.get('valine-newest-comments')
      if (data) {
        generateHtml(JSON.parse(data))
      } else {
        getComment()
      }
    }
  }

  newestCommentInit()
  document.addEventListener('pjax:complete', newestCommentInit)
})</script><div class="aplayer no-destroy" data-id="5771" data-server="netease" data-type="artist" data-fixed="true" data-mini="true" data-listFolded="true" data-order="random" data-autoplay="true" data-lrctype="1" data-preload="auto"></div><script defer="defer" id="ribbon" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/dist/canvas-ribbon.min.js" size="100" alpha="0.3" zIndex="-1" mobile="false" data-click="true"></script><script id="click-heart" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/dist/click-heart.min.js" async="async" mobile="false"></script><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.js"></script><script src="https://cdn.jsdelivr.net/gh/metowolf/MetingJS@1.2/dist/Meting.min.js"></script><script src="https://cdn.jsdelivr.net/npm/pjax/pjax.min.js"></script><script>let pjaxSelectors = [
  'title',
  '#config-diff',
  '#body-wrap',
  '#rightside-config-hide',
  '#rightside-config-show',
  '.js-pjax'
]

if (false) {
  pjaxSelectors.unshift('meta[property="og:image"]', 'meta[property="og:title"]', 'meta[property="og:url"]')
}

var pjax = new Pjax({
  elements: 'a:not([target="_blank"])',
  selectors: pjaxSelectors,
  cacheBust: false,
  analytics: false,
  scrollRestoration: false
})

document.addEventListener('pjax:send', function () {

  // removeEventListener toc scroll 
  window.removeEventListener('scroll', window.tocScrollFn)

  typeof preloader === 'object' && preloader.initLoading()
  
  if (window.aplayers) {
    for (let i = 0; i < window.aplayers.length; i++) {
      if (!window.aplayers[i].options.fixed) {
        window.aplayers[i].destroy()
      }
    }
  }

  typeof typed === 'object' && typed.destroy()

  //reset readmode
  const $bodyClassList = document.body.classList
  $bodyClassList.contains('read-mode') && $bodyClassList.remove('read-mode')

})

document.addEventListener('pjax:complete', function () {
  window.refreshFn()

  document.querySelectorAll('script[data-pjax]').forEach(item => {
    const newScript = document.createElement('script')
    const content = item.text || item.textContent || item.innerHTML || ""
    Array.from(item.attributes).forEach(attr => newScript.setAttribute(attr.name, attr.value))
    newScript.appendChild(document.createTextNode(content))
    item.parentNode.replaceChild(newScript, item)
  })

  GLOBAL_CONFIG.islazyload && window.lazyLoadInstance.update()

  typeof chatBtnFn === 'function' && chatBtnFn()
  typeof panguInit === 'function' && panguInit()

  // google analytics
  typeof gtag === 'function' && gtag('config', '', {'page_path': window.location.pathname});

  // baidu analytics
  typeof _hmt === 'object' && _hmt.push(['_trackPageview',window.location.pathname]);

  typeof loadMeting === 'function' && document.getElementsByClassName('aplayer').length && loadMeting()

  // Analytics
  if (false) {
    MtaH5.pgv()
  }

  // prismjs
  typeof Prism === 'object' && Prism.highlightAll()

  typeof preloader === 'object' && preloader.endLoading()
})

document.addEventListener('pjax:error', (e) => {
  if (e.request.status === 404) {
    pjax.loadUrl('/404.html')
  }
})</script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>